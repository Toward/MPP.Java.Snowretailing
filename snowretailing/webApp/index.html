<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SnowRetailing</title>

    <!-- Material Design Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">

</head>

<body>

    <!-- Modal -->
    <div class="modal fade" id="modalLogin" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4><i class="fa fa-user"></i> Login</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                    <div class="row">
                        <form class="col-md-12">
                            <div class="row">
                                <div class="input-field">
                                    <input id="icon_email" type="tel" class="validate">
                                    <label for="icon_email">Your login</label>
                                </div>

                                <div class="input-field">
                                    <input id="password" type="password" class="validate">
                                    <label for="password">Password</label>
                                </div>
                                <div class="text-center">
                                    <button type="button" class="login btn btn-primary waves-effect waves-light">Login</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- /.Modal content-->
        </div>
    </div>
    <!-- Modal -->

    <div style="text-align: center">
        <a id="brands" class="items btn btn-default waves-effect waves-light">Brands</a>
        <a id="characteristics" class="items btn btn-default waves-effect waves-light">Characteristics</a>
        <a id="equipments" class="items btn btn-default waves-effect waves-light">Equipments</a>
        <a id="orders" class="items btn btn-default waves-effect waves-light">Orders</a>
        <a id="rents" class="items btn btn-default waves-effect waves-light">Rents</a>
        <a id="reviews" class="items btn btn-default waves-effect waves-light">Reviews</a>
        <a id="types" class="items btn btn-default waves-effect waves-light">Types</a>
        <a id="api-credentials" class="items btn btn-default waves-effect waves-light">Credentials</a>
        <a id="api-users" class="items btn btn-default waves-effect waves-light">Users</a>
        <button id="auth-login" type="button" class="btn btn-danger waves-effect waves-light" data-toggle="modal" data-target="#modalLogin">Login</button>
        <button id="auth-logout" type="button" class="btn btn-danger waves-effect waves-light">Logout</button>
    </div>


    <table class="table table-striped items" style="margin: auto; width: 1000px; margin-top: 50px;">
        <thead>
            <tr id="keys">
                <th>Empty</th>
            </tr>
        </thead>
        <tbody id="items">
            <tr>
                <td>...</td>
            </tr>
        </tbody>
    </table>


     <footer class="page-footer blue center-on-small-only fixed bottom" style="position: fixed; bottom: 0; width: 100%">
        <div class="footer-copyright text-center rgba-black-light">
            <div class="container-fluid" style="text-align: center">
                <span id="userid" style="margin-left: 30px"></span>
                <span id="login" style="margin-left: 30px"></span>
                <span id="role" style="margin-left: 30px"></span>
            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->

    <!-- JQuery -->
    <!-- <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script> -->
    <script type="text/javascript" src="js/jquery.min.js"></script>

    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>

    <!-- Material Design Bootstrap -->
    <script type="text/javascript" src="js/mdb.min.js"></script>

    <script type="text/javascript">

        var HOST = 'http://localhost:8080/';

        $('a.items').on('click', function() {

            var address = $(this).attr('id').replace('-', '/');

            $.ajax({
                url: HOST + address,
                type: 'GET',
                dataType: 'json',
                contentType: 'application/json',
                // beforeSend: function (request) {
                //     request.setRequestHeader('Token', window.localStorage.getItem('token'));
                //  },
//                xhrFields: {
//                    withCredentials: true
//                },
                headers: {
                   "Token": window.localStorage.getItem('token')
                },
                success: function (data) {
                    toastr.success(data.message);

                    $('table.items').html('<thead><tr id="keys"><th>Empty</th></tr></thead><tbody id="items"><tr><td>...</td></tr></tbody>');

                    if (data.data !== null && data.data.length) {

                        $('#keys').html('');
                        for (key in data.data[0]) {
                            $('#keys').append('<th>' + key + '</th>');
                        }

                        $('#items').html('');
                        $.each(data.data, function (id, item) {
                            $('#items').append('<tr>');
                            $.each(item, function (property, value) {
                                $('#items > tr:last-child').append('<th>' + value + '</th>');
                            });
                            $('#items > tr:last-child').append('<th><a data-collections="' + $(this).attr('id') + '" class="btn btn-warning waves-effect waves-light">Edit</a></th>')
                            $('#items > tr:last-child').append('<th><a data-collections="' + $(this).attr('id') + '" class="btn btn-danger waves-effect waves-light">Delete</a></th>')
                        });

                        $('table.items').attr('data-collections', $(this).attr('id'));
                        $('table.items').append('<a data-collections="' + $(this).attr('id') + '" class="create btn btn-success waves-effect waves-light">Create</a>')

                    }
                },
                error: function () {
                    toastr.warning('You don\'t have permissions or something was wrong!');
                }
            });
        });

        $('#auth-login').on('click', function() {

            var address = $(this).attr('id').replace('-', '/');

            $('button.login').on('click', function() {

                var $login = $('#icon_email').val();
                var $password = $('#password').val();

                $.ajax({
                    url: HOST + address,
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    crossDomain: true,
                    data: JSON.stringify({
                        login: $login,
                        password: $password
                    }),

                    success: function (data) {
                        toastr.success(data.message);

                        window.localStorage.setItem('token', data.data.token);

                        console.log(data);

                        $('#userid').html(data.data.id);
                        $('#login').html(data.data.login);
                        $('#role').html(data.data.role);
                    },
                    error: function () {
                        toastr.warning('Something was wrong!');
                    }
                });

            });
        });

        $('#auth-logout').on('click', function() {
            window.localStorage.setItem('token', '');
        });

        $('a.create').on('click', function () {
            var address = $(this).attr('data-collections');

        });

    </script>

</body>

</html>
